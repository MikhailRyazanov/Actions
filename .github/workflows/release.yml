name: Release on TestPyPI

on:
  # trigger manually to release any branch/tag on TestPyPI
  workflow_dispatch:
    inputs:
      testpypi:
        description: 'Test release on TestPyPI'
        required: true
        default: 'yes'
        type: choice
        options:
          - yes
    env:
      PYPI_URL: https://test.pypi.org/p/
  # trigger automatically on version tag creation
  # (by "Publish release" on GitHub)
  push:
    tags:
    - 'v[0-9]+.*'
    env:
      PYPI_URL: https://pypi.org/p/

jobs:
  publish:
    runs-on: ubuntu-22.04
    environment: pypi
    #permissions:
    #  # required for Trusted Publishing
    #  id-token: write
    steps:
    - env:
        PYPI_URL: >-
          ${{ github.event_name == 'workflow_dispatch' &&
              'https://test.pypi.org/p/' ||
              'https://pypi.org/p/' }}
      run: |
        echo ${{ github.event_name }}
        echo ${{ env.PYPI_URL }}

    #- name: Download package
    #  run: |
    #    gh run download -R '${{ github.repository }}' \
    #                    -n 'package-${{ github.ref_name }}' \
    #                    -D dist
    #  env:
    #    GH_TOKEN: ${{ github.token }}
    #- name: Publish to TestPyPI
    #  uses: pypa/gh-action-pypi-publish@release/v1
    #  with:
    #    repository-url: https://test.pypi.org/legacy/
    #    verbose: true
